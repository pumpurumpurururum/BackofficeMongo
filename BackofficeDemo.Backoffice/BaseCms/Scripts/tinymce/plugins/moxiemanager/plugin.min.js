(function(n,t){"use strict";function u(n,t){for(var u,e=[],i=0;i<n.length;++i){if(u=r[n[i]]||f(n[i]),!u)throw"module definition dependecy not found: "+n[i];e.push(u)}t.apply(null,e)}function i(n,i,f){if(typeof n!="string")throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(f===t)throw"invalid module definition, definition function must be specified";u(i,function(){r[n]=f.apply(null,arguments)})}function f(t){for(var i=n,u=t.split(/[.\/]/),r=0;r<u.length;++r){if(!i[u[r]])return;i=i[u[r]]}return i}function e(i){for(var f,o=0;o<i.length;o++){var e=n,s=i[o],u=s.split(/[.\/]/);for(f=0;f<u.length-1;++f)e[u[f]]===t&&(e[u[f]]={}),e=e[u[f]];e[u[u.length-1]]=r[s]}}var r={};i("moxman/util/Loader",[],function(){function i(){}function r(n){document.getElementsByTagName("head")[0].appendChild(n)}var u=0,t={},n={maxLoadTime:5,load:function(t,i,r){function e(){f.length?n.loadScript(f.shift(),e,r):o()}function o(){u.length?n.loadCss(u.shift(),o,r):i()}var u=t.css||[],f=t.js||[];e()},loadScript:function(n,u,f){function s(){t[n]=!0;u()}var o,e;if(t[n]){u();return}if(u=u||i,f=f||i,e=document.createElement("script"),e.type="text/javascript",typeof n=="object")for(o in n)e.setAttribute(o,n[o]);else e.src=n;"onload"in e?(e.onload=s,e.onerror=f):(e.onreadystatechange=function(){var n=e.readyState;(n=="complete"||n=="loaded")&&s()},e.onerror=f);r(e)},loadCss:function(f,e,o){function a(){t[f]=!0;e()}function p(){var n=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(n&&n[1]<536)}function v(){for(var r=c.styleSheets,t,u=r.length,i;u--;)if(t=r[u],i=t.ownerNode?t.ownerNode:t.owningElement,i&&i.id===s.id){a();return}(new Date).getTime()-l<n.maxLoadTime*1e3?window.setTimeout(v,0):o()}function y(){try{var t=h.sheet.cssRules;return a(),t}catch(i){}(new Date).getTime()-l<n.maxLoadTime*1e3?window.setTimeout(y,0):o()}var c=document,s,h,l;if(t[f]){e();return}if(e=e||i,o=o||i,s=c.createElement("link"),s.rel="stylesheet",s.type="text/css",s.href=f,s.id="u"+u++,l=(new Date).getTime(),"onload"in s&&!p())s.onload=a,s.onerror=o;else{if(navigator.userAgent.indexOf("Firefox")>0){h=c.createElement("style");h.textContent='@import "'+f+'"';y();r(h);return}v()}r(s)}};return n});i("moxman/Env",[],function(){return{apiPageName:"api.ashx",ie7:document.all&&!window.opera&&!document.documentMode}});i("moxman/util/I18n",[],function(){function i(n){for(var t=window,r=n.split(/\//),i=0;i<r.length;++i){if(!t[r[i]])return;t=t[r[i]]}return t}var t=i("moxman/util/I18n"),n;return t?t:(n={},{add:function(t,i){for(var r in i)n[r]=i[r]},translate:function(t){if(typeof t=="undefined")return t;if(typeof t!="string"&&"raw"in t)return t.raw;if(t.push){var i=t.slice(1);t=(n[t[0]]||t[0]).replace(/\{([^\}]+)\}/g,function(n,t){return i[t]})}return n[t]||t},data:n})});i("moxman/Loader",["moxman/util/Loader","moxman/Env","moxman/util/I18n"],function(n,t,i){function r(r){return function(u){function s(){moxman.Env.baseUrl=t.baseUrl;moxman.Env.apiPageUrl=t.baseUrl+"/"+t.apiPageName;moxman.util.JsonRpc.url=moxman.Env.apiPageUrl;moxman.ui.Control.translate=i.translate;moxman.ui.FloatPanel.zIndex=u.zIndex||moxman.ui.FloatPanel.zIndex;var n=new moxman.Manager(u);n.init(new moxman.views[r](n))}var o,f,e;if(u=u||{},!t.baseUrl)for(o=document.getElementsByTagName("script"),f=0;f<o.length;f++)if(e=o[f].src,/(^|\/)moxman\./.test(e)){t.baseUrl=e.substring(0,e.lastIndexOf("/"))+"/..";t.apiPageUrl=t.baseUrl+"/"+t.apiPageName;break}moxman.ui?s():n.load({js:[t.baseUrl+"/js/moxman.api.min.js",t.apiPageUrl+"?action=language"+(u.language?"&code="+u.language:""),t.apiPageUrl+"?action=PluginJs"],css:[t.baseUrl+"/skins/lightgray/skin"+(t.ie7?".ie7":"")+".min.css"]},s)}}var u=this||window,f={browse:r("FileListView"),upload:r("UploadView"),edit:r("EditView"),zip:r("ZipView"),createDir:r("CreateDirView"),createDoc:r("CreateDocView"),view:r("ViewFileView"),rename:r("RenameView")},e;u.moxman=u.moxman||{};for(e in f)u.moxman[e]=f[e];return u.moxman.addI18n=i.add,f});i("moxman/interop/TinyMcePlugin",["moxman/Loader","moxman/Env"],function(n,t){tinymce.PluginManager.add("moxiemanager",function(i,r){function f(n){var t={},i;return tinymce.each(u,function(n,i){i.indexOf("moxiemanager_")===0&&(t[i.substring(13)]=n)}),i=u["moxiemanager_"+n+"_settings"],i&&tinymce.each(i,function(n,i){i=i.replace(/moxiemanager_/g,"");t[i]=n}),t}function e(n,t,i){function r(n,t){var i,r;for(i=0,r=n,t=t.split(".");i<t.length;i++)r=r[t[i]];return r}return typeof n!="string"?n(t,i):(n=""+n.replace(/\{\$([^\}]+)\}/g,function(n,u){var e,o=u.split("|"),f=r(t,o[0]);if(typeof f=="undefined")return"";for(o.length==1&&i&&i.xmlEncode&&(f=i.xmlEncode(f)),e=1;e<o.length;e++)f=i[o[e]](f,t,u);return f}),n.replace(/\{\=([\w]+)([^\}]+)\}/g,function(n,u,f){return r(i,u)(t,u,f)}))}var u=i.settings;t.baseUrl=r;t.apiPageUrl=r+"/"+t.apiPageName;u.file_browser_callback=function(t,r,e,o){var s=i.windowManager.zIndex;tinymce.ui.FloatPanel&&(s=tinymce.ui.FloatPanel.currentZIndex);n.browse(tinymce.extend({zIndex:s,url:i.documentBaseURI.toAbsolute(r),document_base_url:u.document_base_url,view:e=="image"||e=="media"?"thumbs":"files",multiple:!1,oninsert:function(n){var u=o.document.getElementById(t),f=n.focusedFile.path,s=f.indexOf("/"),h=f.indexOf("/",s+1),r=i.settings.imagesUrl,e;r[r.length-1]!="/"&&(r=r.trim("/"));u.value=r+f.substring(h,f.length);"fireEvent"in u?u.fireEvent("onchange"):(e=document.createEvent("HTMLEvents"),e.initEvent("change",!1,!0),u.dispatchEvent(e))}},f(e)))};i.addCommand("mceInsertFile",function(){function s(n,t){return e(n,t,{urlencode:function(n){return encodeURIComponent(n)},xmlEncode:function(n){return tinymce.DOM.encode(n)},sizeSuffix:function(n){return n==-1?"":n>1048576?Math.round(n/1048576,1)+" MB":n>1024?Math.round(n/1024,1)+" KB":n+" b"}})}var t=i.selection,r,o;r=t.getRng();o=i.windowManager.zIndex;tinymce.ui.FloatPanel&&(o=tinymce.ui.FloatPanel.currentZIndex);n.browse(tinymce.extend({zIndex:o,document_base_url:u.document_base_url,oninsert:function(n){var u="";tinymce.each(n.files,function(n,f){var e=/\.(gif|jpe?g|png)$/i.test(n.name);if(t.setRng(r),!e&&!t.isCollapsed())return i.execCommand("mceInsertLink",n.meta.url),!1;f>0&&(u+=" ");u+=e?s(i.getParam("moxiemanager_image_template",'<img src="{$meta.url}" width="{$meta.width}" height="{$meta.height}">'),n):s(i.getParam("moxiemanager_file_template",'<a href="{$url}">{$name}<\/a>'),n)});t.setRng(r);i.execCommand("mceInsertContent",!1,u)}},f()))});tinymce.Env?i.addButton("insertfile",{icon:"browse",title:"Insert file",cmd:"mceInsertFile"}):i.addButton("insertfile",{image:r+"/skins/lightgray/img/insertfile.gif",title:i.getLang("moxiemanager_insert","Insert file"),cmd:"mceInsertFile"})});var i=tinymce.settings?tinymce.settings.language:"auto";i&&i!="en"&&tinymce.ScriptLoader.load((tinymce.PluginManager.urls.moxiemanager||tinymce.baseURL+"/plugins/moxiemanager")+"/"+t.apiPageName+"?action=language&tinymce=true&code="+i)});e(["moxman/util/Loader","moxman/Env","moxman/util/I18n","moxman/Loader","moxman/interop/TinyMcePlugin"])})(this);
/*
//# sourceMappingURL=plugin.min.js.map
*/